<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Minecraft Color by Number</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <main class="center-col">

    <h1>ðŸŽ¨ Minecraft Color-by-Number</h1>

    <div id="splash" class="splash-text"></div>

    <!-- Summary counters -->
    <div id="completion-summary" class="summary-text"></div>
    <div id="category-summary" class="summary-text" style="display:none;"></div>

    <!-- Search + Random -->
    <div id="top-controls">
      <input id="search-box" type="text" placeholder="Search blocks...">
      <button id="random-btn">ðŸŽ² Random</button>
    </div>

    <!-- CATEGORY FILTERS -->
    <div id="category-bar">
      <button class="cat-btn selected" data-cat="all">All</button>
      <button class="cat-btn" data-cat="Armor">Armor</button>
      <button class="cat-btn" data-cat="Blocks">Blocks</button>
      <button class="cat-btn" data-cat="Brewing">Brewing</button>
      <button class="cat-btn" data-cat="Decoration">Decoration</button>
      <button class="cat-btn" data-cat="Enchanting">Enchanting</button>
      <button class="cat-btn" data-cat="End">End</button>
      <button class="cat-btn" data-cat="End Mobs">End Mobs</button>
      <button class="cat-btn" data-cat="Food">Food</button>
      <button class="cat-btn" data-cat="Items">Items</button>
      <button class="cat-btn" data-cat="Nether">Nether</button>
      <button class="cat-btn" data-cat="Nether Mobs">Nether Mobs</button>
      <button class="cat-btn" data-cat="Ores">Ores</button>
      <button class="cat-btn" data-cat="Overworld Mobs">Overworld Mobs</button>
      <button class="cat-btn" data-cat="Plants">Plants</button>
      <button class="cat-btn" data-cat="Tables">Tables</button>
      <button class="cat-btn" data-cat="Tools">Tools</button>
      <button class="cat-btn" data-cat="Transportation">Transportation</button>
      <button class="cat-btn" data-cat="Weapons">Weapons</button>
      <button class="cat-btn" data-cat="Miscellaneous">Miscellaneous</button>
    </div>

    <div id="thumb-grid" class="thumb-grid"></div>
  </main>

  <script src="pictures.js"></script>
  <script src="splashes.js"></script>
  <script src="index.js"></script>
  <script>
    // ===============================
    // ELEMENTS
    // ===============================
    const grid = document.getElementById("thumb-grid");
    const searchBox = document.getElementById("search-box");
    const randomBtn = document.getElementById("random-btn");
    const catBtns = document.querySelectorAll(".cat-btn");
    const completionSummary = document.getElementById("completion-summary");
    const categorySummary = document.getElementById("category-summary");

    let activeCategory = "all";

    // Convert PICTURES â†’ list of objects
    let entries = Object.entries(window.PICTURES).map(([id, pic]) => ({
      id,
      name: pic.name || id,
      category: pic.category || "Blocks",
      data: pic.data,
      colors: pic.colors
    }));

    entries.sort((a, b) => a.name.localeCompare(b.name));

    // ===============================
    // RENDER GALLERY
    // ===============================
    function render(list) {
      grid.innerHTML = "";

      list.forEach(pic => {
        const tile = document.createElement("a");
        tile.className = "thumb";
        tile.href = `color.html?name=${encodeURIComponent(pic.id)}`;

        if (localStorage.getItem("completed_" + pic.id) === "true") {
          tile.classList.add("completed");
        }

        const previewCanvas = document.createElement("canvas");
        const ctx = previewCanvas.getContext("2d");

        const rows = pic.data.length;
        const cols = pic.data[0].length;

        const scale = Math.floor(64 / Math.max(rows, cols)) || 4;
        previewCanvas.width = cols * scale;
        previewCanvas.height = rows * scale;

        for (let r = 0; r < rows; r++) {
          for (let c = 0; c < cols; c++) {
            ctx.fillStyle = pic.colors[pic.data[r][c]];
            ctx.fillRect(c * scale, r * scale, scale, scale);
          }
        }

        const label = document.createElement("div");
        label.className = "thumb-label";
        label.textContent = pic.name;

        tile.appendChild(previewCanvas);
        tile.appendChild(label);
        grid.appendChild(tile);
      });

      updateSummaries(list);
    }

    // ===============================
    // SUMMARY COUNTERS
    // ===============================
    function updateSummaries(currentList) {
      const allPics = entries;
      const totalCount = allPics.length;

      const totalCompleted = allPics.filter(p =>
        localStorage.getItem("completed_" + p.id) === "true"
      ).length;

      // Always show total completed
      completionSummary.textContent =
        `Completed: ${totalCompleted} / ${totalCount}`;

      // Hide category summary for ALL
      if (activeCategory === "all") {
        categorySummary.style.display = "none";
        return;
      }

      const picsInCat = allPics.filter(p => p.category === activeCategory);
      const completedInCat = picsInCat.filter(p =>
        localStorage.getItem("completed_" + p.id) === "true"
      ).length;

      categorySummary.style.display = "block";
      categorySummary.textContent =
        `${activeCategory}: ${completedInCat} / ${picsInCat.length} completed`;
    }

    // ===============================
    // APPLY FILTERS
    // ===============================
    function applyFilters() {
      const q = searchBox.value.trim().toLowerCase();

      const filtered = entries.filter(p => {
        const matchSearch =
          p.name.toLowerCase().includes(q) ||
          p.id.toLowerCase().includes(q);

        const matchCategory =
          activeCategory === "all" ||
          p.category === activeCategory;

        return matchSearch && matchCategory;
      });

      render(filtered);
    }

    searchBox.addEventListener("input", applyFilters);

    catBtns.forEach(btn =>
      btn.addEventListener("click", () => {
        catBtns.forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");

        activeCategory = btn.dataset.cat;
        applyFilters();
      })
    );

    // ===============================
    // RANDOM BUTTON
    // ===============================
    randomBtn.addEventListener("click", () => {
      const filtered = entries.filter(p =>
        activeCategory === "all" ? true : p.category === activeCategory
      );
      const choice = filtered[Math.floor(Math.random() * filtered.length)];
      window.location.href = `color.html?name=${choice.id}`;
    });

    // Initial load
    render(entries);
  </script>
</body>
</html>
