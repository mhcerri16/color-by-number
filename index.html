<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Minecraft Color by Number</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <main class="center-col">

    <h1>ðŸŽ¨ Minecraft Color-by-Number</h1>

    <!-- SEARCH + RANDOM -->
    <div id="top-controls">
      <input id="search-box" type="text" placeholder="Search blocks...">
      <button id="random-btn">ðŸŽ² Random</button>
    </div>

    <p class="hint small">Browse or search for a block below.</p>

    <div id="thumb-grid" class="thumb-grid"></div>
  </main>

  <script src="pictures.js"></script>
  <script>
    const grid = document.getElementById("thumb-grid");
    const searchBox = document.getElementById("search-box");
    const randomBtn = document.getElementById("random-btn");

    // Convert PICTURES object to a sortable array
    const entries = Object.entries(window.PICTURES || {})
      .map(([id, pic]) => ({
        id,
        name: pic.name || id,
        data: pic.data,
        colors: pic.colors
      }))
      .sort((a, b) => a.name.localeCompare(b.name));

    // Render thumbnails
    function render(list) {
      grid.innerHTML = "";

      list.forEach(pic => {
        const tile = document.createElement("a");
        tile.className = "thumb";
        tile.href = `color.html?name=${encodeURIComponent(pic.id)}`;

        const previewCanvas = document.createElement("canvas");
        const pctx = previewCanvas.getContext("2d");

        const rows = pic.data.length;
        const cols = pic.data[0].length;
        const scale = Math.floor(64 / Math.max(rows, cols)) || 4;
        const size = scale;

        previewCanvas.width = cols * size;
        previewCanvas.height = rows * size;
        previewCanvas.style.imageRendering = "pixelated";

        for (let r = 0; r < rows; r++) {
          for (let c = 0; c < cols; c++) {
            const code = pic.data[r][c];
            pctx.fillStyle = pic.colors[code];
            pctx.fillRect(c * size, r * size, size, size);
          }
        }

        const label = document.createElement("div");
        label.className = "thumb-label";
        label.textContent = pic.name;

        tile.appendChild(previewCanvas);
        tile.appendChild(label);
        grid.appendChild(tile);
      });
    }

    // Initial display
    render(entries);

    // === SEARCH FILTER ===
    searchBox.addEventListener("input", () => {
      const q = searchBox.value.trim().toLowerCase();

      const filtered = entries.filter(p =>
        p.id.toLowerCase().includes(q) ||
        p.name.toLowerCase().includes(q)
      );

      render(filtered);
    });

    // === RANDOM BUTTON ===
    randomBtn.addEventListener("click", () => {
      const choice = entries[Math.floor(Math.random() * entries.length)];
      window.location.href = `color.html?name=${encodeURIComponent(choice.id)}`;
    });
  </script>
</body>
</html>
