<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Minecraft Color by Number</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <main class="center-col">

    <h1>ðŸŽ¨ Minecraft Color-by-Number</h1>

    <!-- Search + Random -->
    <div id="top-controls">
      <input id="search-box" type="text" placeholder="Search blocks...">
      <button id="random-btn">ðŸŽ² Random</button>
    </div>

    <!-- CATEGORY FILTERS -->
    <div id="category-bar">
      <button class="cat-btn selected" data-cat="all">All</button>
      <button class="cat-btn" data-cat="Armor">Armor</button>
      <button class="cat-btn" data-cat="Blocks">Blocks</button>
      <button class="cat-btn" data-cat="Brewing">Brewing</button>
      <button class="cat-btn" data-cat="Decoration">Decoration</button>
      <button class="cat-btn" data-cat="Enchanting">Enchanting</button>
      <button class="cat-btn" data-cat="Food">Food</button>
      <button class="cat-btn" data-cat="Nether">Nether</button>
      <button class="cat-btn" data-cat="Ores">Ores</button>
      <button class="cat-btn" data-cat="Plants">Plants</button>
      <button class="cat-btn" data-cat="Tools">Tools</button>
      <button class="cat-btn" data-cat="Transportation">Transportation</button>
      <button class="cat-btn" data-cat="Weapons">Weapons</button>
      <button class="cat-btn" data-cat="Miscellaneous">Miscellaneous</button>
    </div>

    <div id="thumb-grid" class="thumb-grid"></div>
  </main>

  <script src="pictures.js"></script>
  <script>
    const grid = document.getElementById("thumb-grid");
    const searchBox = document.getElementById("search-box");
    const randomBtn = document.getElementById("random-btn");
    const catBtns = document.querySelectorAll(".cat-btn");

    // Convert PICTURES â†’ easy structure
    let entries = Object.entries(window.PICTURES).map(([id, pic]) => ({
      id,
      name: pic.name || id,
      category: pic.category || "Blocks",
      data: pic.data,
      colors: pic.colors
    }));

    entries.sort((a, b) => a.name.localeCompare(b.name));

    function render(list) {
      grid.innerHTML = "";

      list.forEach(pic => {
        const tile = document.createElement("a");
        tile.className = "thumb";
        tile.href = `color.html?name=${encodeURIComponent(pic.id)}`;

        const previewCanvas = document.createElement("canvas");
        const pctx = previewCanvas.getContext("2d");

        const rows = pic.data.length;
        const cols = pic.data[0].length;
        const scale = Math.floor(64 / Math.max(rows, cols)) || 4;
        previewCanvas.width = cols * scale;
        previewCanvas.height = rows * scale;

        for (let r = 0; r < rows; r++) {
          for (let c = 0; c < cols; c++) {
            const val = pic.data[r][c];
            pctx.fillStyle = pic.colors[val];
            pctx.fillRect(c * scale, r * scale, scale, scale);
          }
        }

        const label = document.createElement("div");
        label.className = "thumb-label";
        label.textContent = pic.name;

        tile.appendChild(previewCanvas);
        tile.appendChild(label);
        grid.appendChild(tile);
      });
    }

    // === INITIAL RENDER ===
    render(entries);

    // === SEARCH + CATEGORY FILTER COMBINED ===
    let activeCategory = "all";

    function applyFilters() {
      const q = searchBox.value.trim().toLowerCase();

      const filtered = entries.filter(p => {
        const matchesSearch =
          p.id.toLowerCase().includes(q) ||
          p.name.toLowerCase().includes(q);

        const matchesCategory =
          activeCategory === "all" ||
          p.category === activeCategory;

        return matchesSearch && matchesCategory;
      });

      render(filtered);
    }

    searchBox.addEventListener("input", applyFilters);

    catBtns.forEach(btn =>
      btn.addEventListener("click", () => {
        catBtns.forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");
        activeCategory = btn.dataset.cat;
        applyFilters();
      })
    );

    // === RANDOM BUTTON ===
    randomBtn.addEventListener("click", () => {
      const filtered = entries.filter(p =>
        activeCategory === "all" ? true : p.category === activeCategory
      );
      const choice = filtered[Math.floor(Math.random() * filtered.length)];
      window.location.href = `color.html?name=${choice.id}`;
    });
  </script>
</body>
</html>
